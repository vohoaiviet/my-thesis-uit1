\chapter{Thực nghiệm và đánh giá kết quả}
\ifpdf
    \graphicspath{{Chapter4/Chapter4Figs/PNG/}{Chapter4/Chapter4Figs/PDF/}{Chapter4/Chapter4Figs/}}
\else
    \graphicspath{{Chapter4/Chapter4Figs/EPS/}{Chapter4/Chapter4Figs/}}
\fi
\markboth{\MakeUppercase{\thechapter. Các bộ dữ liệu và phương thức đánh giá}}{\thechapter. Các bộ dữ liệu và phương thức đánh giá}

Để đánh giá hiệu suất của một hệ thống truy vấn ảnh, ta cần cài đặt và thử nghiệm với những quy trình đánh giá chuẩn. Đồng thời so sánh nó với các hệ thống khác trong cùng một điều kiện thí nghiệm.

Với ý tưởng như đã trình bày trong chương trước, trong Chương này chúng tôi sẽ mô tả chi tiết cách cài đặt thí nghiệm cũng như quy trình đánh giá hiệu suất của hệ thống đề xuất đồng thời so sánh kết quả với các phương pháp khác. Trước tiên, chi tiết về các bộ dữ liệu và phương pháp dùng để đánh giá sẽ được trình bày một cách chi tiết trong mục \ref{data-evaluate}. Cách cài đặt các phương pháp cơ sở cũng như phương pháp đề xuất sẽ được mô tả trong mục \ref{experimental-setting}. Và cuối cùng trong mục \ref{experimental-result}, chúng tôi sẽ đánh giá phương pháp đề xuất và so sánh với các phương pháp khác dựa trên kết quả thí nghiệm thu được để đưa ra kết luận.

\section{Các bộ dữ liệu và phương thức đánh giá}
\label{data-evaluate}
Mục này trình bày quy trình đánh giá chuẩn được sử dụng rộng rãi trong truy vấn đối tượng trên tập dữ liệu lớn. Trước tiên là mô tả về các bộ dữ liệu chuẩn, sau đó là phần trình bày chi tiết về phương thức đánh giá cho các kết quả thí nghiệm.

\subsection{Các bộ dữ liệu}

\subsubsection{Oxford 5k}
Bộ dữ liệu Oxford 5k được xây dựng bởi \cite{philbin2007object}, bao gồm 11 Oxford "landmark"\footnote{landmark ở đây có nghĩa là một góc nhìn/góc chụp đặc biệt của một tòa nhà} cùng các hình ảnh gây nhiễu. Hình ảnh cho mỗi landmark được tự động lấy về từ trang chia sẻ ảnh trực tuyến Flickr sử dụng các câu truy vấn như "Oxford Christ Church" và "Oxford Radcliffee Camera", đồng thời các hình ảnh gây nhiễu cũng được lấy về bằng câu truy vấn "Oxford". Bộ dữ liệu bao gồm 5,062 hình ảnh chất lượng cao (1366 $\times$ 768).\\
\textit{Tập dữ liệu đánh giá chuẩn} (ground truth) được xây dựng thủ công cho 11 landmark. Các hình ảnh được gán vào một trong bốn nhãn: \textit{Good} nếu nó là một hình ảnh rõ ràng và đầy đủ về đối tượng/tòa nhà, \textit{OK} nếu hình ảnh chứa hơn 25\% của đối tượng và \textit{Junk} nếu hình ảnh chứa ít hơn 25\% của đối tượng hoặc đối tượng bị che khuất phần lớn hoặc hình ảnh đối tượng bị méo mó nhiều.\\
Bộ dữ liệu gồm 55 truy vấn trong đó mỗi landmark sẽ có 5 truy vấn. Các đối tượng sẽ được khoanh vùng trên các hình ảnh truy vấn. Tất cả các truy vấn được thể hiện trong hình \ref{FigOxfordDataset}.

\begin{figure}[!htbp]
  \begin{center}
    \leavevmode
    \ifpdf
      \includegraphics[scale=0.27]{oxfordDataset}
    \else
      \includegraphics[scale=0.27]{oxfordDataset}
    \fi
    \caption[Landmark và các truy vấn được dùng để đánh giá]{\textbf{Landmark và các truy vấn được dùng để đánh giá.} 55 hình ảnh truy vấn được sử dụng trong tập dữ liệu đánh giá chuẩn. Mỗi hàng là 5 hình của 5 truy vấn khác nhau cho cùng một cảnh landmark. Hình ảnh được lấy từ bài báo \citep{philbin2007object}.}
    \label{FigOxfordDataset}
  \end{center}
\end{figure}

\subsubsection{Paris 6k}
Tương tự như bộ dữ liệu Oxford 5k, Paris 6k bao gồm 6,392 hình ảnh chất lượng cao (1366 $\times$ 768) của các địa danh nổi tiếng ở Paris được lấy về từ Flickr với các câu truy vấn như "Paris Eiffel Tower" hay "Paris Triomphe". Paris 6k cũng có 55 hình ảnh truy vấn cho 11 landmark (5 truy vấn cho mỗi landmark) (\cite{philbin2008lost}).\\
Paris 6k được đánh giá là một bộ dữ liệu hoàn toàn độc lập so với Oxford 5k và thường được dùng để kiểm tra các tác động của việc tính toán từ trực quan trong khi Oxford 5k thường được dùng để kiểm tra hiệu suất.\\

\subsubsection{Holidays}
Bộ Holidays bao gồm 1,491 hình ảnh chất lượng cao về các lễ hội với 500 truy vấn mà mỗi truy vấn chứa một vài hình ảnh chính xác về đối tượng truy vấn (\cite{JDS08}). Bộ dữ liệu này nhằm hướng tới mục đích truy vấn ảnh trên tập dữ liệu lớn vì các hình ảnh không phải về một đối tượng đặc biệt như trong Oxford 5k và Paris 6k, đồng thời các thay đổi trên hình ảnh của đối tượng cũng đa dạng hơn với nhiều loại thay đổi khác nhau và truy vấn được thực hiện với toàn bộ hình ảnh chứ không phải với một vùng hình ảnh có chứa đối tượng được chỉ định trước.\\
Tập dữ liệu bao gồm 500 nhóm hình ảnh, mỗi nhóm là một cảnh khác nhau và bao gồm rất nhiều loại hình ảnh khác nhau như tự nhiên, nhân tạo, hiệu ứng nước và lửa,... Hình ảnh đầu tiên của mỗi nhóm là hình truy vấn và các hình còn lại trong nhóm là kết quả chính xác cho truy vấn. Và các hình ảnh truy vấn không được xem xét tới trong kết quả trả về chứ không phải được xem là một kết quả chính xác như trong Oxford 5k và Paris 6k.\\
Thông thường bô dữ liệu Holidays thường được ghép với khoảng 1 triệu hình ảnh từ Flickr khác để kiểm tra truy vấn trên tập dữ liệu lớn, thường được gọi là bộ dữ liệu \textit{Holidays + Flickr1M}.\\

Các bộ dữ liệu trên được tổng hợp trong bảng \ref{table:dataset}.
\begin{table}
\begin{center}
	\begin{tabular}{c c c}
	\hline
	Bộ dữ liệu & Số lượng hình ảnh & Số lượng truy vấn \\ \hline
    Oxford 5k & 5062 & 55 \\ 
    Paris 6k & 6412 & 55 \\
    Holidays & 1491 & 500 \\
	\hline
	%\label{table:datasets}
	\end{tabular}
\end{center}
\caption[Số hình ảnh trong mỗi bộ dữ liệu và số truy vấn trong tập dữ liệu đánh giá chuẩn tương ứng]{Số hình ảnh trong mỗi bộ dữ liệu và số truy vấn trong tập dữ liệu đánh giá chuẩn tương ứng.}
\label{table:dataset}
\end{table}

\subsection{Phương thức đánh giá}
\label{evaluation}
Với mỗi truy vấn, để đánh giá kết quả trả về ta thường dùng độ đo \textit{precision-recall} (PR). Precision là tỉ lệ giữa số kết quả đúng trả về trong tổng số kết quả trả về. Recall là tỉ số của số kết quả đúng trả về trên tổng số hình ảnh đúng trong tập dữ liệu. Hay nói theo cách khác, precison cho thấy độ "tinh khiết" của kết quả trả về, còn recall cho biết đã tìm thấy bao nhiêu phần của đáp án.\\
Tùy theo từng mục đích mà người ta sẽ tập trung vào việc nâng cao precision hay recall. Ví dụ, những ứng dụng như Google Goggles\footnote{Google Goggles là một ứng dụng nhận dạng hình ảnh được phát hành bởi Google. Người sử dụng điện thoại di động chỉ cần chụp ảnh của đối tượng như xe hơi, đồ chơi, bìa sách, mã vạch,... sau đó Goggles sẽ quét và đối chiếu kho dữ liệu để hiển thị thông tin liên quan đến vật đó.} thì câu hỏi nó cần phải trả lời là "Nó là cái gì?", do đó nó chỉ chú ý đến việc đạt được chỉ số precison tối đa có thể, tức là lấy được những kết quả đúng nhưng vừa đủ để nhận dạng đối tượng. Trong nhiều trường hợp khác thì chỉ số recall cũng được quan tâm. Ví dụ việc tái tạo không gian ba chiều đòi hỏi phải tìm được đủ số lượng hình ảnh của đối tượng để xây dựng được mô hình ba chiều chính xác.\\
Để đo hiệu suất thực thi của hệ thống, ở đây ta dùng độ đo average precision (AP) (\cite{philbin2007object}), nó cũng tương đương với phần diện tích bên dưới đường biểu diễn cho chỉ số precision-recall trong biểu đồ. Một đường biểu diễn precision-recall lý tưởng có chỉ số precision bằng 1 trên tất cả các mức recall khác nhau và nó tương ứng chỉ số average precision bằng 1. Average precision được tính cho từng truy vấn một sau đó ta lấy trung bình cộng của chúng, đó chính là mean Average Precision (mAP) - một con số để đánh giá hiệu suất tổng thể của hệ thống.

\section{Cài đặt thí nghiệm}
\label{experimental-setting}
Để đánh giá hiệu suất của từng phương pháp, chúng tôi cài đặt các phương pháp cơ sở và phương pháp đề xuất như sau:\\
-- \textbf{Phương pháp cơ sở 1:} Sử dụng mô hình BoW + phương pháp chỉ mục ngược cơ bản với xếp hạng dựa trên bầu chọn (voting).\\
-- \textbf{Phương pháp cơ sở 2:} Sử dụng mô hình BoW + phương pháp chỉ mục ngược cơ bản với xếp hạng bằng việc tính toán khoảng cách giữa hình ảnh truy vấn với mỗi hình ảnh ứng viên. Các hình ảnh được biểu diễn bằng mô hình SPM (\cite{lazebnik2006beyond}).\\
-- \textbf{Phương pháp để xuất:} Sử dụng mô hình BoW + phương pháp chỉ mục ngược được tính hợp thông tin không gian ảnh do chúng tôi đề xuất cho việc lập chỉ mục và xếp hạng.

Dưới đây là chi tiết cài đặt và các thông số cho phương pháp đề xuất.

\textbf{Phát hiện và mô tả các điểm đặc trưng.} Để phát hiện các điểm đặc trưng cho từng hình ảnh, chúng tôi sử dụng bộ phát hiện đặc trưng Hessian-Affine (\cite{mikolajczyk2005comparison}). Đây là một bộ phát hiện bất biến dùng để thu thập các điểm quan tâm trong hình ảnh. Với mỗi điểm đặc trưng, một vector 128 chiều được tạo ra từ bộ mô tả SIFT. Từ vector này, chúng tôi sẽ tính RootSIFT (\cite{arandjelovic2012three}) để đạt được hiệu suất tốt hơn.

\textbf{Gom cụm các đặc trưng.} Khi gom cụm một tập dữ liệu lớn, ta không thể dùng k-Means bởi vì chi phí tính toán quá lớn. Theo như \cite{philbin2007object}, Approximate K-Means (AKM) có thể được sử dụng để thay thế cho k-Means với một chi phí tính toán chấp nhận được. Ở đây chúng tôi sử dụng AKM để gom cụm thành 1 triệu từ trực quan.

\textbf{Tạo chỉ mục ngược.} Như phương pháp đã được trình bày ở trên, số tập chỉ mục ngược sinh ra sẽ bằng với số ô của không gian phân cấp. Mỗi tập chỉ mục sẽ lưu thông tin cho một ô. Tất cả các tập chỉ mục đó sẽ được lưu thành 1 một tập tin duy nhất.

\textbf{Quá trình truy vấn.} Mỗi hình ảnh truy vấn trong tập dữ liệu đánh giá chuẩn sẽ được rút trích các đặc trưng, tính toán ra các từ trực quan từ từ điển rồi sau đó lấy ra danh sách hình ảnh ứng viên từ các tập chỉ mục ngược. Cuối cùng, các hình ảnh ứng viên được xếp hạng bằng phương pháp bầu chọn.

\section{Kết quả thí nghiệm và đánh giá kết quả}
\label{experimental-result}

\begin{table}
\begin{center}
	\begin{tabular}{l c c c}
	\hline
	\begin{tabular}[l]{@{}l@{}}Phương pháp\\(trên Oxford 5k)\end{tabular} & mAP & \begin{tabular}[l]{@{}c@{}}Thời gian truy vấn\\(55 truy vấn)\end{tabular} & Bộ nhớ sử dụng\\ \hline
    \begin{tabular}[l]{@{}l@{}}Phương pháp\\cơ sở 1\end{tabular} & 0.5678 & 0.0788 (s)  & 68.31MB \\ 
    \begin{tabular}[l]{@{}l@{}}Phương pháp\\cơ sở 2\end{tabular} & 0.6204 & 30.1153 (s) & 68.31MB\\ 
    \begin{tabular}[l]{@{}l@{}}\textbf{Phương pháp}\\\textbf{đề xuất} ($L=2$)\end{tabular} & \textbf{0.5851} & \textbf{0.1651} (s) & \textbf{481.69MB} \\
	\hline
	\end{tabular} \\
\end{center}
\caption[Hiệu suất của các phương pháp trên bộ dữ liệu Oxford 5k]{Hiệu suất của các phương pháp trên bộ dữ liệu Oxford 5k.}
\label{table:oxford5k}
\end{table}

Bảng \ref{table:oxford5k} thể hiện kết quả chi tiết khi chạy thí nghiệm trên bộ dữ liệu Oxford 5k. Có thể thấy rằng phương pháp cơ sở 1 (sử dụng chỉ mục ngược căn bản và xếp hạng bằng bầu chọn) cho độ chính xác thấp với chỉ số mAP = 0.5678 nhưng tốc độ truy vấn rất nhanh với tổng thời gian truy vấn là 0.0788 giây.

Trong khi đó, với việc tích hợp thông tin không gian ảnh vào trong chỉ mục ngược, phương pháp đề xuất cho độ chính xác mAP = 0.5851. Ở đây chúng tôi sử dụng mô hình không gian phân cấp ở cấp 2 ($L = 2$, bao gồm 21 tâp chỉ mục ngược). Thời gian truy vấn cho 55 truy vấn từ tập dữ liệu đánh giá chuẩn là 0.1651s (khoảng 3ms cho mỗi truy vấn) cũng không quá chênh lệch so với phương pháp cơ sở 1.

Phương pháp cho độ chính xác cao nhất (mAP = 0.6204) là phương pháp cơ sở 2. Phương pháp này tốn rất nhiều chi phí cho quá trình xếp hạng. Để xếp hạng các ứng viên, phương pháp này tính và so sánh khoảng cách L2 (khoảng cách Euclidean) giữa hình ảnh truy vấn và từng hình ảnh ứng viên, các hình ảnh này được biểu diễn bằng mô hình SPM. Do đó, phương pháp này cho thời gian truy vấn rất lâu, \textbf{gấp khoảng 182 lần} so với phương pháp đề xuất.

Kết quả trên cho thấy phương pháp của chúng tôi đã cân bằng được độ chính xác và thời gian truy vấn so với các phương pháp khác. Ta có thể thấy kết quả tương tự khi thử nghiệm với bộ Paris 6k và Holidays lần lượt trong Bảng \ref{table:paris6k} và Bảng \ref{table:holidays}. Biểu đồ trong Hình \ref{FigCharts} cho thấy sự so sánh tương quan giữa các phương pháp khi thử nghiệm trên bộ dữ liệu Oxford 5k.

\begin{table}
\begin{center}
	\begin{tabular}{l c c c}
	\hline
	\begin{tabular}[l]{@{}l@{}}Phương pháp\\(trên Paris 6k)\end{tabular} & mAP & \begin{tabular}[l]{@{}c@{}}Thời gian truy vấn\\(55 truy vấn)\end{tabular} & Bộ nhớ sử dụng\\ \hline
    \begin{tabular}[l]{@{}l@{}}Phương pháp\\cơ sở 1\end{tabular} & 0.5762  & 0.1137 (s)  & 80.37MB \\
    \begin{tabular}[l]{@{}l@{}}Phương pháp\\cơ sở 2\end{tabular} & 0.6421 & 40.5526 (s) & 80.37MB \\
    \begin{tabular}[l]{@{}l@{}}\textbf{Phương pháp}\\\textbf{đề xuất} ($L=2$)\end{tabular} & \textbf{0.5967} & \textbf{0.2158} (s) & \textbf{519.10MB} \\
	\hline
	\end{tabular} \\
\end{center}
\caption[Hiệu suất của các phương pháp trên bộ dữ liệu Paris 6k]{Hiệu suất của các phương pháp trên bộ dữ liệu Paris 6k.}
\label{table:paris6k}
\end{table}


\begin{table}
\begin{center}
	\begin{tabular}{l c c c}
	\hline
	\begin{tabular}[l]{@{}l@{}}Phương pháp\\(trên Holidays)\end{tabular} & mAP & \begin{tabular}[l]{@{}c@{}}Thời gian truy vấn\\(55 truy vấn)\end{tabular} & Bộ nhớ sử dụng\\ \hline
    \begin{tabular}[l]{@{}l@{}}Phương pháp\\cơ sở 1\end{tabular} & ---  & --- (s)  & --- \\
    \begin{tabular}[l]{@{}l@{}}Phương pháp\\cơ sở 2\end{tabular} & --- & --- (s) & --- \\
    \begin{tabular}[l]{@{}l@{}}\textbf{Phương pháp}\\\textbf{đề xuất} ($L=2$)\end{tabular} & \textbf{---} & \textbf{---} (s) & \textbf{---} \\
	\hline
	\end{tabular} \\
\end{center}
\caption[Hiệu suất của các phương pháp trên bộ dữ liệu Holidays]{Hiệu suất của các phương pháp trên bộ dữ liệu Holidays.}
\label{table:holidays}
\end{table}


\begin{figure}[!htbp]
  \begin{center}
    \leavevmode
    \ifpdf
      \includegraphics[scale=0.4]{chart}
    \else
      \includegraphics[scale=0.4]{chart}
    \fi
    \caption[Biểu đồ so sánh độ chính xác và thời gian truy vấn giữa các phương pháp]{Biểu đồ so sánh độ chính xác và thời gian truy vấn giữa các phương pháp trên bộ Oxford 5k.}
    \label{FigCharts}
  \end{center}
\end{figure}

Kết quả thí nghiệm trên cả ba bộ dữ liệu đều cho thấy hiệu quả của việc tích hợp thông tin không gian ảnh vào chỉ mục ngược. Các thí nghiệm trên đều sử dụng thông số $L = 2$ ($L$ là thông số để thiếp lập cho cấp cao nhất của không gian phân cấp). Để kiểm tra sự phụ thuộc của kết quả vào $L$, chúng tôi cũng đã đo đạc kết quả với các mức $L$ khác nhau. Chi tiết được thể hiện trong Bảng \ref{table:oxford5k-test-level} và bảng \ref{table:paris6k-test-level}. Có thể thấy rõ rằng khi giá trị của $L$ tăng thì độ chính xác cũng tăng. Điều đó nghĩa là khi tích hợp thông tin không gian ảnh với những lưới ô vuông phân cấp càng dày thì sự khác nhau giữa các hình ảnh sẽ càng được thể hiện rõ nét hơn. Tuy nhiên, không phải lúc nào $L$ tăng thì độ chính xác cũng sẽ tăng theo.

\begin{table}
\begin{center}
	\begin{tabular}{c c c c c}
	\hline
	$L$ & mAP & \begin{tabular}[l]{@{}c@{}}Số tập\\chỉ mục ngược\end{tabular}  & \begin{tabular}[l]{@{}c@{}}Thời gian truy vấn\\(55 truy vấn)\end{tabular} & \begin{tabular}[l]{@{}l@{}}Bộ nhớ\\sử dụng\end{tabular}\\ \hline
    $L=0$ &  0.5678 & 1  & 0.0794 (s)  & 68.31MB \\ 
    $L=1$ &  0.5791 & 5  & 0.1092 (s)  & 183.17MB \\
    \textbf{$L=2$} & \textbf{0.5851} & \textbf{21} & \textbf{0.1651 (s)}&\textbf{418.69MB} \\
    $L=3$ &  0.5779 & 85 & 0.1806 (s)  & 1.48GB \\ 
		\hline
	\end{tabular}
\end{center}
\caption[Hiệu suất của phương pháp đề xuất với các giá trị khác nhau của $L$ trên bộ dữ liệu Oxford 5K]{Hiệu suất của phương pháp đề xuất với các giá trị khác nhau của $L$ trên bộ dữ liệu Oxford 5K.}
\label{table:oxford5k-test-level}	
\end{table}


\begin{table}
\begin{center}
	\begin{tabular}{c c c c c}
	\hline
	$L$ & mAP & \begin{tabular}[l]{@{}c@{}}Số tập\\chỉ mục ngược\end{tabular}  & \begin{tabular}[l]{@{}c@{}}Thời gian truy vấn\\(55 truy vấn)\end{tabular} & \begin{tabular}[l]{@{}l@{}}Bộ nhớ\\sử dụng\end{tabular}\\ \hline
    $L=0$ &  0.5762  & 1  &   0.1138 (s)  & 80.37MB \\ 
    $L=1$ &  0.5855  & 5  &   0.1523 (s)  & 207.68MB  \\
    \textbf{$L=2$} &\textbf{0.5967}& \textbf{21} &\textbf{ 0.2158 (s)} & \textbf{519.01MB} \\ 
    $L=3$ &  0.5959  & 85 &   0.2953 (s)  & 1.53GB \\ 
		\hline
	\end{tabular}
\end{center}
\caption[Hiệu suất của phương pháp đề xuất với các giá trị khác nhau của $L$ trên bộ dữ liệu Paris 6K]{Hiệu suất của phương pháp đề xuất với các giá trị khác nhau của $L$ trên bộ dữ liệu Paris 6K.}
\label{table:paris6k-test-level}	
\end{table}


\begin{figure}[!htbp]
  \begin{center}
    \leavevmode
    \ifpdf
      \includegraphics[scale=0.25]{queryResult}
    \else
      \includegraphics[scale=0.25]{queryResult}
    \fi
    \caption[Ví dụ thể hiện kết quả khi tìm kiếm một hình ảnh]{Ví dụ thể hiện khi tìm kiếm một hình ảnh. Những kết quả sai được đánh dấu bằng ô có viền màu đỏ.}
    \label{FigResults}
  \end{center}
\end{figure}

Hình \ref{FigResults} cho thấy ví dụ về hình ảnh truy vấn và thể hiện các kết quả trả về với các phương pháp khác nhau. 10 hình ảnh có đứng đầu trong kết quả trả về của các phương pháp được hiển thị. Có thể thấy rằng phương pháp đề xuất của chúng tôi có độ chính xác tương đương với phương pháp cơ sở 2 trong khi kết quả của phương pháp cơ sở 1 vẫn chứa vài hình ảnh sai.
